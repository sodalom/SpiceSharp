# Entities, components and models

## Entities
An **[Entity](xref:SpiceSharp.Circuits.Entity)** is the base class for any object that can be used in simulations. It has three main functions:

- Creating behaviors when asked by a **[Simulation](xref:SpiceSharp.Simulations.Simulation)**. It acts as a behavior *factory*. These factories are registered using the *[RegisterBehaviorFactory](xref:SpiceSharp.Circuits.Entity.RegisterBehaviorFactory(System.Type,SpiceSharp.Behaviors.BehaviorFactoryDictionary))* method, which is typically called in the class static constructor (thread-safe).
- Providing the parameters that may or may not be used by any behavior generated by the entity. These are stored in the **[ParameterSets](xref:SpiceSharp.Circuits.Entity.ParameterSets)** property.
- Connections to nodes or other entities, like models or other dependencies (for example, a mutual inductance that connects to two other inductors). The entity also makes sure that the connected entities are created before the current entity.

Each entity is identified by a unique string, stored in the property *[Name](xref:SpiceSharp.Circuits.Entity.Name)*.

### Creating behaviors
In several cases, the entity depends on information from another entity. It then first needs to create all behaviors of that entity, before creating its own. Behaviors are created in the *[CreateBehaviors](SpiceSharp.Circuits.Entity.CreateBehaviors(System.Type[],SpiceSharp.Simulations.Simulation,SpiceSharp.Circuits.EntityCollection)* method. If the entity requires behaviors of other entities, it first finds them in the entity collection and calls *[CreateBehaviors](SpiceSharp.Circuits.Entity.CreateBehaviors(System.Type[],SpiceSharp.Simulations.Simulation,SpiceSharp.Circuits.EntityCollection)* on them first in this method.

After creating all the behaviors asked for by the simulation, the entity will call  *[Bind](xref:SpiceSharp.Behaviors.Behavior.Bind(SpiceSharp.Simulations.Simulation,SpiceSharp.Behaviors.BindingContext))* on each behavior. The entity provides an argument of type **[BindingContext](xref:SpiceSharp.Behaviors.BindingContext)** with useful information about the linked nodes and entities. The context is built in the *[BuildBindingContext](xref:SpiceSharp.Components.Component.BuildBindingContext(SpiceSharp.Simulations.Simulation)* method. Both the *[CreateBehaviors](SpiceSharp.Circuits.Entity.CreateBehaviors(System.Type[],SpiceSharp.Simulations.Simulation,SpiceSharp.Circuits.EntityCollection)* and the *[BuildBindingContext](xref:SpiceSharp.Components.Component.BuildBindingContext(SpiceSharp.Simulations.Simulation)* need to be overridden to support linked entities.

## Components and Models
The **[Component](xref:SpiceSharp.Components.Component)** and **[Model](xref:SpiceSharp.Components.Model)** classes both extend the **[Entity](xref:SpiceSharp.Circuits.Entity)** class. They provide a framework that is somewhat similar to the way Spice 3f5 originally implemented devices and models.

Each **[Component](xref:SpiceSharp.Components.Component)** can be connected to nodes in the circuit and has a **[Model](xref:SpiceSharp.Components.Model)** reference. In order to find the nodes the entity is connected to, we cast the **[BindingContext](xref:SpiceSharp.Behaviors.BindingContext)** to a **[ComponentBindingContext](xref:SpiceSharp.Components.ComponentBindingContext)** and query the *[Pins](xref:SpiceSharp.Components.ComponentBindingContext.Pins)* property. See the custom component tutorial for an example.

### Component attributes
Using some attributes for entity classes, it is possible to add meta-information for which some can be used by the **[Validator](xref:SpiceSharp.Circuits.Validator)** class to validate the circuit topology.

- **[PinAttribute](xref:SpiceSharp.Attributes.PinAttribute)**: Specifies the name of the pin for components. For example, a diode has 2 pins, *D+* at index 0 and *D-* at index 1, in that order when using the *[Connect](xref:SpiceSharp.Components.Component.Connect(System.String[]))* method to connect the component.
- **[ConnectedAttribute](xref:SpiceSharp.Attributes.ConnectedAttribute)**: This attribute will indicate that two pins are connected by a finite impedance at DC. This attribute can be used by a **[Validator](xref:SpiceSharp.Circuits.Validator)** to find *floating nodes*. Floating nodes can have *any* voltage while still being a solution, which poses a problem for the simulation.
- **[IndependentSourceAttribute](xref:SpiceSharp.Attributes.IndependentSourceAttribute)**: Flags the entity as one that describes an independent source. This attribute can be used by a **[Validator](xref:SpiceSharp.Circuits.Validator)** to make sure there is *at least one independent source in the circuit*.
- **[VoltageDriverAttribute](xref:SpiceSharp.Attributes.VoltageDriverAttribute)**: Indicates that this entity will fix the voltage between two nodes. This attribute can be used by a **[Validator](xref:SpiceSharp.Circuits.Validator)** to find *voltage source loops*.

<div class="pull-left">[Previous: Structure](structure.md)</div> <div class="pull-right">[Next: Parameters](parameters.md)</div>
